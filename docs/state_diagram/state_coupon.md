```mermaid
---
config:
  theme: default
---
stateDiagram-v2
    [*] --> 발급요청됨 : 유저가 쿠폰 발급 요청

    발급요청됨 --> 정책조회중 : 쿠폰 정책 조회
    정책조회중 --> 수량검사중 : 잔여 수량 확인
    수량검사중 --> 수량부족 : 수량 부족
    수량부족 --> [*]

    수량검사중 --> 등급검사중 : 수량 충분
    등급검사중 --> 발급불가 : 유저 등급 미달
    발급불가 --> [*]

    등급검사중 --> 보유여부검사중 : 등급 조건 만족
    보유여부검사중 --> 발급불가 : 유저가 이미 쿠폰 보유
    보유여부검사중 --> 발급진행중 : 유저가 쿠폰 미보유

    발급진행중 --> 발급완료 : 수량 차감 & 히스토리 저장
    발급완료 --> [*]


```